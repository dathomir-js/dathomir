= batch API

#import "../../../../SPEC/settings.typ": *
#show: apply-settings

== 目的

シグナルの通知を単一のフラッシュにまとめながらコールバックを実行する。

== シグネチャ

```typescript
function batch<T>(fn: () => T): T
```

== 動作

=== バッチング

- コールバック内のすべてのシグナル更新が収集される
- 依存先は最後に一度だけ通知される
- 同じシグナルへの複数の更新 → 最終値が使用される

=== ネスト

- ネストされた batch は外側の batch を拡張する
- フラッシュは最も外側の batch が完了したときに発生する

=== 戻り値

- コールバックの結果を返す

== エッジケース

- 空の batch → フラッシュ不要
- コールバック内の例外 → batch は終了し、部分的な更新が可視化される

== テストケース

- batch 内で複数回更新された場合、最終値のみを使用する
- batch の最後に一度だけ通知する
